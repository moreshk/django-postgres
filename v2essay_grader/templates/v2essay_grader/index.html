{% extends "base.html" %}

{% load static %}

{% block content %}
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">

<style>
    .invalid-input {
        border: 1px solid red;
    }
</style>

<div class="container mt-5">
    <h1>NAPLAN Essay Grader</h1>
    <div id="inputArea">
        <form id="essayForm">
            {% csrf_token %}
            <div class="form-group">
                <label for="essayTypeInput">Essay type:</label>
                <select class="form-control" id="essayTypeInput">
                    <option>Narrative</option>
                    <option>Persuasive</option>
                </select>
            </div>
            <div class="form-group">
                <label for="gradeInput">Grade:</label>
                <select class="form-control" id="gradeInput">
                    <option>Grade 3</option>
                    <option>Grade 5</option>
                    <option>Grade 7</option>
                    <option>Grade 9</option>
                </select>
            </div>
            <div class="form-group">
                <label for="titleInput">Title:</label>
                <input type="text" class="form-control" id="titleInput" placeholder="Enter title">
            </div>
            <div class="form-group">
                <label for="descriptionInput">Description:</label>
                <textarea class="form-control" id="descriptionInput" rows="5"
                    placeholder="Enter description"></textarea>
            </div>

            <div id="persuasiveGuidelines" class="container mt-4" style="display:none;">
                <h5 class="mt-4 mb-2">Start with an introduction.</h5>
                <p>An introduction lets a reader know what you are going to write about.</p>

                <h5 class="mt-4 mb-2">Write your reasons for your choice.</h5>
                <p>Why is it important for others to get involved in this activity? Explain your reasons.</p>

                <h5 class="mt-4 mb-2">Finish with a conclusion.</h5>
                <p>A conclusion sums up your reasons so that a reader is convinced of your opinion.</p>

                <h5 class="mt-4 mb-2">Remember to:</h5>
                <ul>
                    <li>plan your writing</li>
                    <li>use paragraphs to organise your ideas</li>
                    <li>write in sentences</li>
                    <li>choose your words carefully to convince a reader of your opinion</li>
                    <li>pay attention to your spelling and punctuation</li>
                    <li>check and edit your writing so it is clear.</li>
                </ul>
            </div>
            <div id="narrativeGuidelines" class="container mt-4">
                <h5 class="mt-4 mb-2">Think about:</h5>
                <ul>
                    <li>the characters in your story</li>
                    <li>when and where your story takes place</li>
                    <li>the complication or problem and how it is solved</li>
                    <li>how the story ends</li>
                </ul>

                <h5 class="mt-4 mb-2">Remember to:</h5>
                <ul>
                    <li>plan your story before you start</li>
                    <li>choose your words carefully</li>
                    <li>write in sentences</li>
                    <li>pay attention to your spelling, punctuation, and paragraphs</li>
                    <li>check and edit your writing</li>
                </ul>
            </div>

            <button type="button" class="btn btn-primary" onclick="submitForm()">Create Test</button>
        </form>
    </div>

    <div id="outputArea"
        style="display:none; background-color: #e9e9e9; padding: 15px; border-radius: 5px; margin-top: 20px;">
        <p><strong>Essay Type:</strong> <span id="essayTypeOutput"></span></p>
        <p><strong>Grade:</strong> <span id="gradeOutput"></span></p>
        <p><strong>Title:</strong> <span id="titleOutput"></span></p>
        <p><strong>Description:</strong> <span id="descriptionOutput"></span></p>
    </div>

    <div class="mt-2 text-left" id="refreshIcon" style="display:none;">
        <button onclick="resetForm()" class="btn btn-link">
            <i class="fas fa-redo-alt"></i>
        </button>
    </div>

    <div id="gradingArea" style="display:none;">
        <div class="form-group mt-4">
            <textarea class="form-control" id="gradingTextarea" rows="5"
                placeholder="Your text goes here ..."></textarea>
        </div>

        <button type="button" class="btn btn-primary" onclick="gradeText()">Grade</button>
        <div class="spinner-border text-primary" role="status" id="loadingSpinner" style="display: none;">
            <span class="sr-only">Loading...</span>
        </div>
    </div>

    <div id="gradingOutput" style="margin-top: 20px;"></div>

</div>

<!-- Logout Link -->
<div class="mt-5 text-center">
    <a href="{% url 'logout' %}">Logout</a>
</div>

<script>
    function submitForm() {
        if (!validateForm()) {
            return; // Stop the function if validation fails
        }
        // Get the values
        let essayType = document.getElementById("essayTypeInput").value;
        let grade = document.getElementById("gradeInput").value;
        let title = document.getElementById("titleInput").value;
        let description = document.getElementById("descriptionInput").value;

        // Set the values in the output area
        document.getElementById("essayTypeOutput").textContent = essayType;
        document.getElementById("gradeOutput").textContent = grade;
        document.getElementById("titleOutput").textContent = title;
        document.getElementById("descriptionOutput").textContent = description;

        // Hide input fields
        document.getElementById("inputArea").style.display = "none";
        // Show output area
        document.getElementById("outputArea").style.display = "block";
        // Show refresh icon
        document.getElementById("refreshIcon").style.display = "block";

        let persuasiveGuidelines = document.getElementById("persuasiveGuidelines");
        let narrativeGuidelines = document.getElementById("narrativeGuidelines");

        if (essayType === "Persuasive") {
            persuasiveGuidelines.style.display = "block";
            narrativeGuidelines.style.display = "none";
        } else {
            persuasiveGuidelines.style.display = "none";
            narrativeGuidelines.style.display = "block";
        }

        let outputArea = document.getElementById("outputArea");
        let currentGuidelines = (document.getElementById("essayTypeInput").value === "Persuasive")
            ? document.getElementById("persuasiveGuidelines")
            : document.getElementById("narrativeGuidelines");

        let clonedGuidelines = currentGuidelines.cloneNode(true);
        outputArea.appendChild(clonedGuidelines);

        // Show gradingArea after form is submitted
        document.getElementById("gradingArea").style.display = "block";


    }


    function resetForm() {
        document.getElementById("inputArea").style.display = "block";
        document.getElementById("outputArea").style.display = "none";
        // Hide refresh icon
        document.getElementById("refreshIcon").style.display = "none";
        // document.getElementById("additionalInfo").value = "";
        // Reset dropdown to default and trigger the change event to display the appropriate guidelines
        let essayDropdown = document.getElementById("essayTypeInput");
        essayDropdown.selectedIndex = 0;
        essayDropdown.dispatchEvent(new Event('change'));
        // Hide gradingArea when form is reset
        document.getElementById("gradingArea").style.display = "none";
        // Remove the appended feedback (if exists) from outputArea
        let outputArea = document.getElementById("outputArea");
        let feedbackElement = outputArea.lastChild;
        if (feedbackElement && feedbackElement.nodeName === "DIV" && !feedbackElement.classList.contains('container')) {
            outputArea.removeChild(feedbackElement);
        }

        // Clear the gradingOutput content
        document.getElementById("gradingOutput").innerHTML = "";
    }

    document.getElementById("essayTypeInput").addEventListener("change", function () {
        let persuasiveGuidelines = document.getElementById("persuasiveGuidelines");
        let narrativeGuidelines = document.getElementById("narrativeGuidelines");

        if (this.value === "Persuasive") {
            persuasiveGuidelines.style.display = "block";
            narrativeGuidelines.style.display = "none";
        } else {
            persuasiveGuidelines.style.display = "none";
            narrativeGuidelines.style.display = "block";
        }

        let outputArea = document.getElementById("outputArea");
        let clonedGuidelines = outputArea.querySelector('.container.mt-4');
        if (clonedGuidelines) {
            outputArea.removeChild(clonedGuidelines);
        }
    });


    function validateForm() {
        let titleInput = document.getElementById("titleInput");
        let descriptionInput = document.getElementById("descriptionInput");

        // Check if the inputs are empty and highlight them if they are
        let isTitleEmpty = titleInput.value.trim() === "";
        let isDescriptionEmpty = descriptionInput.value.trim() === "";

        if (isTitleEmpty) {
            titleInput.classList.add("invalid-input");
        } else {
            titleInput.classList.remove("invalid-input");
        }

        if (isDescriptionEmpty) {
            descriptionInput.classList.add("invalid-input");
        } else {
            descriptionInput.classList.remove("invalid-input");
        }

        if (isTitleEmpty || isDescriptionEmpty) {
            alert("Both title and description must be filled out!");
            return false;
        }

        return true;
    }

    function gradeText() {
        // Show the spinner
        document.getElementById("loadingSpinner").style.display = "block";

        let user_response = document.getElementById("gradingTextarea").value;
        let title = document.getElementById("titleOutput").textContent;
        let description = document.getElementById("descriptionOutput").textContent;
        let essay_type = document.getElementById("essayTypeOutput").textContent;
        let grade = document.getElementById("gradeOutput").textContent;

        let requestData = {
            user_response: user_response,
            title: title,
            description: description,
            essay_type: essay_type,
            grade: grade
        };

        console.log("first api call", requestData);
        fetch('/v2essay_grader/grade_essay/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify(requestData)
        })
            .then(response => response.json())
            .then(responseData => {
                let feedback = responseData.feedback;

                // Get the grading output div and clear its previous content
                let gradingOutputDiv = document.getElementById("gradingOutput");
                gradingOutputDiv.innerHTML = "";

                // Display the result in the grading output div
                let feedbackElement = document.createElement("div");
                feedbackElement.textContent = feedback;
                gradingOutputDiv.appendChild(feedbackElement);

                if (feedback === "Provided essay input is relevant to the title and description." && document.getElementById("essayTypeInput").value === "Persuasive") {

                    fetch('/v2essay_grader/grade_essay_audience/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify(requestData) // 'data' should include the required parameters
                    })
                        .then(response => response.json())
                        .then(responseData => {
                            // Create a new header element
                            let headerElement1 = document.createElement("h4");
                            headerElement1.textContent = "Audience (Scored out of 6)";
                            gradingOutputDiv.appendChild(headerElement1);
                            console.log(responseData)
                            let grade_essay_audienceOutput = responseData.feedback;



                            // Display the result in the grading output div
                            let grade_essay_audienceElement = document.createElement("div");
                            grade_essay_audienceElement.innerHTML = grade_essay_audienceOutput;
                            gradingOutputDiv.appendChild(grade_essay_audienceElement);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                    // End of audience grading
                    // Make an AJAX call to the text structure grading function

                    fetch('/v2essay_grader/grade_essay_text_structure/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify(requestData) // 'data' should include the required parameters
                    })
                        .then(response => response.json())
                        .then(responseData => {
                            // Create a new header element
                            let headerElement2 = document.createElement("h4");
                            headerElement2.textContent = "Text Structure (Scored out of 4)";
                            gradingOutputDiv.appendChild(headerElement2);
                            console.log(responseData)
                            let grade_essay_audienceOutput = responseData.feedback;

                            // Display the result in the grading output div
                            let grade_essay_audienceElement = document.createElement("div");
                            grade_essay_audienceElement.innerHTML = grade_essay_audienceOutput;
                            gradingOutputDiv.appendChild(grade_essay_audienceElement);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                    // End of text structure grading
                    // Make an AJAX call to the Ideas grading function

                    fetch('/v2essay_grader/grade_essay_ideas/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify(requestData) // 'data' should include the required parameters
                    })
                        .then(response => response.json())
                        .then(responseData => {
                            // Create a new header element
                            let headerElement3 = document.createElement("h4");
                            headerElement3.textContent = "Ideas (Scored out of 5)";
                            gradingOutputDiv.appendChild(headerElement3);
                            console.log(responseData)
                            let grade_essay_audienceOutput = responseData.feedback;

                            // Display the result in the grading output div
                            let grade_essay_audienceElement = document.createElement("div");
                            grade_essay_audienceElement.innerHTML = grade_essay_audienceOutput;
                            gradingOutputDiv.appendChild(grade_essay_audienceElement);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                    // End of Ideas grading
                    // Make an AJAX call to the Persuasive Devices grading function

                    fetch('/v2essay_grader/grade_essay_persuasive_devices/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify(requestData) // 'data' should include the required parameters
                    })
                        .then(response => response.json())
                        .then(responseData => {
                            // Create a new header element
                            let headerElement4 = document.createElement("h4");
                            headerElement4.textContent = "Persuasive Devices (Scored out of 4)";
                            gradingOutputDiv.appendChild(headerElement4);
                            console.log(responseData)
                            let grade_essay_audienceOutput = responseData.feedback;

                            // Display the result in the grading output div
                            let grade_essay_audienceElement = document.createElement("div");
                            grade_essay_audienceElement.innerHTML = grade_essay_audienceOutput;
                            gradingOutputDiv.appendChild(grade_essay_audienceElement);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                    // End of Persuasive devices grading

                    // Make an AJAX call to the vocabulary grading function

                    fetch('/v2essay_grader/grade_essay_vocabulary/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify(requestData) // 'data' should include the required parameters
                    })
                        .then(response => response.json())
                        .then(responseData => {
                            // Create a new header element
                            let headerElement5 = document.createElement("h4");
                            headerElement5.textContent = "Vocabulary (Scored out of 5)";
                            gradingOutputDiv.appendChild(headerElement5);
                            console.log(responseData)
                            let grade_essay_audienceOutput = responseData.feedback;

                            // Display the result in the grading output div
                            let grade_essay_audienceElement = document.createElement("div");
                            grade_essay_audienceElement.innerHTML = grade_essay_audienceOutput;
                            gradingOutputDiv.appendChild(grade_essay_audienceElement);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                    // End of vocabulary grading

                    // Make an AJAX call to the cohesion grading function

                    fetch('/v2essay_grader/grade_essay_cohesion/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify(requestData) // 'data' should include the required parameters
                    })
                        .then(response => response.json())
                        .then(responseData => {
                            // Create a new header element
                            let headerElement6 = document.createElement("h4");
                            headerElement6.textContent = "Cohesion (Scored out of 4)";
                            gradingOutputDiv.appendChild(headerElement6);
                            console.log(responseData)
                            let grade_essay_audienceOutput = responseData.feedback;

                            // Display the result in the grading output div
                            let grade_essay_audienceElement = document.createElement("div");
                            grade_essay_audienceElement.innerHTML = grade_essay_audienceOutput;
                            gradingOutputDiv.appendChild(grade_essay_audienceElement);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                    // End of cohesion grading

                    // Make an AJAX call to the paragraphing grading function

                    fetch('/v2essay_grader/grade_essay_paragraphing/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify(requestData) // 'data' should include the required parameters
                    })
                        .then(response => response.json())
                        .then(responseData => {
                            // Create a new header element
                            let headerElement7 = document.createElement("h4");
                            headerElement7.textContent = "Paragraphing (Scored out of 2)";
                            gradingOutputDiv.appendChild(headerElement7);
                            console.log(responseData)
                            let grade_essay_audienceOutput = responseData.feedback;

                            // Display the result in the grading output div
                            let grade_essay_audienceElement = document.createElement("div");
                            grade_essay_audienceElement.innerHTML = grade_essay_audienceOutput;
                            gradingOutputDiv.appendChild(grade_essay_audienceElement);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                    // End of paragraphing grading

                    // Make an AJAX call to the grade_essay_sentence_structure grading function

                    fetch('/v2essay_grader/grade_essay_sentence_structure/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify(requestData) // 'data' should include the required parameters
                    })
                        .then(response => response.json())
                        .then(responseData => {
                            // Create a new header element
                            let headerElement8 = document.createElement("h4");
                            headerElement8.textContent = "Sentence Structure (Scored out of 6)";
                            gradingOutputDiv.appendChild(headerElement8);
                            console.log(responseData)
                            let grade_essay_audienceOutput = responseData.feedback;

                            // Display the result in the grading output div
                            let grade_essay_audienceElement = document.createElement("div");
                            grade_essay_audienceElement.innerHTML = grade_essay_audienceOutput;
                            gradingOutputDiv.appendChild(grade_essay_audienceElement);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                    // End of Sentence Structure

                    // Make an AJAX call to the grade_essay_punctuation grading function

                    fetch('/v2essay_grader/grade_essay_punctuation/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify(requestData) // 'data' should include the required parameters
                    })
                        .then(response => response.json())
                        .then(responseData => {
                            // Create a new header element
                            let headerElement9 = document.createElement("h4");
                            headerElement9.textContent = "Punctuation (Scored out of 6)";
                            gradingOutputDiv.appendChild(headerElement9);
                            console.log(responseData)
                            let grade_essay_audienceOutput = responseData.feedback;

                            // Display the result in the grading output div
                            let grade_essay_audienceElement = document.createElement("div");
                            grade_essay_audienceElement.innerHTML = grade_essay_audienceOutput;
                            gradingOutputDiv.appendChild(grade_essay_audienceElement);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                    // End of grade_essay_punctuation grading

                    // Make an AJAX call to the grade_essay_spelling grading function

                    fetch('/v2essay_grader/grade_essay_spelling/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify(requestData) // 'data' should include the required parameters
                    })
                        .then(response => response.json())
                        .then(responseData => {
                            // Create a new header element
                            let headerElement10 = document.createElement("h4");
                            headerElement10.textContent = "Spelling (Scored out of 6)";
                            gradingOutputDiv.appendChild(headerElement10);
                            console.log(responseData)
                            let grade_essay_audienceOutput = responseData.feedback;

                            // Display the result in the grading output div
                            let grade_essay_audienceElement = document.createElement("div");
                            grade_essay_audienceElement.innerHTML = grade_essay_audienceOutput;
                            gradingOutputDiv.appendChild(grade_essay_audienceElement);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                    // End of grade_essay_spelling grading


                }

                // Narrative Grading

                if (feedback === "Provided essay input is relevant to the title and description." && document.getElementById("essayTypeInput").value === "Narrative") {

                    // Criteria 2. Text structure: The organisation of narrative features including orientation, complication and resolution into an appropriate and effective text structure. 
                    // Score Range: 0-4 
                    // Scoring guide: 
                    // 0- no evidence of any structural components of a times equenced text • symbols or drawings • inappropriate genre, e.g. a recipe, argument • title only
                    // 1- minimal evidence of narrative structure, e.g. a story beginning only or a ‘middle’ with no orientation • a recount of events with no complication • note that not all recounts are factual • may be description
                    // 2- contains a beginning and a complication • where a resolution is present it is weak, contrived or ‘tacked on’ (e.g. I woke up, I died, They lived happily ever after) • a complication presents a problem to be solved, introduces tension, and requires a response. It drives the story forward and leads to a series of events or responses • complications should always be read in context • may also be a complete story where all parts of the story are weak or minimal (the story has a problem to be solved but it does not add to the tension or excitement).
                    // 3 - contains orientation, complication and resolution • detailed longer text may resolve one complication and lead into a new complication or layer a new complication onto an existing one rather than conclude
                    // 4- coherent, controlled and complete narrative, employing effective plot devices in an appropriate structure, and including an effective ending. sophisticated structures or plot devices include: – foreshadowing/flashback – red herring/cliffhanger – coda/twist – evaluation/reflection – circular/parallel plots

                    // Criteria 3. Ideas: The creation, selection and crafting of ideas for a narrative.
                    // Score Range: 0-5 
                    // Scoring guide: 
                    // 0 - • no evidence or insufficient evidence • symbols or drawings • title only
                    // 1 - • one idea OR • ideas are very few and very simple OR • ideas appear unrelated to each other OR • ideas appear unrelated to prompt
                    // 2 - • one idea with simple elaboration OR • ideas are few and related but not elaborated OR • many simple ideas are related but not elaborated
                    // 3 - • ideas show some development or elaboration • all ideas relate coherently
                    // 4 - • ideas are substantial and elaborated AND contribute effectively to a central storyline • the story contains a suggestion of an underlying theme
                    // 5 - ideas are generated, selected and crafted to explore a recognisable theme • ideas are skilfully used in the service of the storyline • ideas may include: – psychological subjects – unexpected topics – mature viewpoints – elements of popular culture – satirical perspectives – extended metaphor – traditional sub-genre subjects: heroic quest / whodunnit / good vs evil / overcoming the odds

                    // Criteria 4 .Character and setting: Character: the portrayal and development of character. 
                    // Setting: the development of a sense of place, time and atmosphere.
                    // Score Range: 0-4 
                    // Scoring guide: 

                    // 0 - no evidence or insufficient evidence, symbols or drawings, writes in wrong genre, title only

                    // 1 - only names characters or gives their roles (e.g. father, the teacher, my friend, dinosaur, we, Jim) AND/OR only names the setting (e.g.school, the place we were at) setting is vague or confused	
                    // 2 - suggestion of characterisation through brief descriptions or speech or feelings, but lacks substance or continuity 
                    // AND/OR
                    // suggestion of setting through very brief and superficial descriptions of place and/or time	
                    // basic dialogue or a few adjectives to describe a character or a place

                    // 3 - characterisation emerges through descriptions, actions, speech or the attribution of thoughts and feelings to a character
                    // AND/OR
                    // setting emerges through description of place, time and atmosphere	

                    // 4 - effective characterisation: details are selected to create distinct characters
                    // AND/OR
                    // Maintains a sense of setting throughout. Details are selected to create a sense of place and atmosphere. convincing dialogue, introspection and reactions to other characters

                    // Criteria 5. Vocabulary: The range and precision of language choices. 
                    // Score Range: 0-5 
                    // Scoring guide: 
                    // 0 - symbols or drawings
                    // 1 - very short script
                    // 2 - mostly simple verbs, adverbs, adjectives or nouns may include two or three precise words or word groups
                    // 3 - four or more precise words or word groups (may be verbs, adverbs, adjectives or nouns)
                    // 4 - sustained and consistent use of precise words and word groups that enhance the meaning or mood
                    // may be occasional inappropriate or inaccurate word choice
                    // 5 - a range of precise and effective words and word groups used in a natural and articulate manner, language choice is well matched to genre

                    // Criteria 6. Cohesion: The control of multiple threads and relationships over the whole text, achieved through the use of referring words, substitutions, word associations and text connectives. 
                    // Score Range: 0-4 
                    // Scoring guide: 
                    // 0 - symbols or drawings
                    // 1 - links are missing or incorrect short script often confusing for the reader
                    // 2 - some correct links between sentences (do not penalise for poor punctuation), 
                    // most referring words are accurate. reader may occasionally need to re-read and provide their own links to clarify meaning
                    // 3 - cohesive devices are used correctly to support reader understanding, accurate use of referring words,
                    // meaning is clear and text flows well in a sustained piece of writing
                    // 4 - a range of cohesive devices is used correctly and deliberately to enhance reading, an extended, highly cohesive piece of writing showing continuity of ideas and tightly linked sections of text

                    // Criteria 7. Paragraphs: The segmenting of text into paragraphs that assists the reader to negotiate the narrative. 
                    // Score Range: 0-2 
                    // Scoring guide: 
                    // 0 - no use of paragraphing
                    // 1 - writing is organised into paragraphs that are mainly focused on a single idea or set of like ideas that assist the reader to digest chunks of text
                    // contains at least one correct paragraph break
                    // 2 - all paragraphs are focused on one idea or set of like ideas and enhance the narrative

                    // Criteria 8. Sentence structure: The production of grammatically correct, structurally sound and meaningful sentences. 
                    // Score Range: 0-6 
                    // Scoring guide: 
                    // 0 -	no evidence of sentences
                    // 1 - some correct formation of sentences, some meaning can be construed
                    // 2 - correct sentences are mainly simple and/or compound sentences, meaning is predominantly clear
                    // 3 - most (approx. 80%) simple and compound sentences correct
                    // AND some complex sentences are correct meaning is predominantly clear
                    // 4 - most (approx. 80%) simple, compound and complex sentences are correct
                    // OR all simple, compound and complex sentences are correct but do not demonstrate variety meaning is clear
                    // 5 - sentences are correct (allow for occasional error in more sophisticated structures)
                    // demonstrates variety meaning is clear and sentences enhance meaning
                    // 6 - all sentences are correct (allow for occasional slip, e.g. a missing word) writing contains controlled and well developed sentences that express precise meaning and are
                    // consistently effective

                    // Criteria 9. Punctuation: The use of correct and appropriate punctuation to aid reading of the text. 
                    // Score Range: 0-5 

                    // 2.1. Make an AJAX call to the grade_narrative_audience grading function

                    fetch('/v2essay_grader/grade_narrative_audience/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify(requestData) // 'data' should include the required parameters
                    })
                        .then(response => response.json())
                        .then(responseData => {
                            // Create a new header element
                            let headerElement11 = document.createElement("h4");
                            headerElement11.textContent = "Narrative Audience (Scored out of 6)";
                            gradingOutputDiv.appendChild(headerElement11);
                            console.log(responseData)
                            let grade_essay_audienceOutput = responseData.feedback;

                            // Display the result in the grading output div
                            let grade_essay_audienceElement = document.createElement("div");
                            grade_essay_audienceElement.innerHTML = grade_essay_audienceOutput;
                            gradingOutputDiv.appendChild(grade_essay_audienceElement);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                    // End of grade_narrative_audience grading

                    // 2.1. Make an AJAX call to the grade_narrative_text_structure grading function

                    fetch('/v2essay_grader/grade_narrative_text_structure/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify(requestData) // 'data' should include the required parameters
                    })
                        .then(response => response.json())
                        .then(responseData => {
                            // Create a new header element
                            let headerElement12 = document.createElement("h4");
                            headerElement12.textContent = "Narrative Text Structure (Scored out of 4)";
                            gradingOutputDiv.appendChild(headerElement12);
                            console.log(responseData)
                            let grade_essay_audienceOutput = responseData.feedback;

                            // Display the result in the grading output div
                            let grade_essay_audienceElement = document.createElement("div");
                            grade_essay_audienceElement.innerHTML = grade_essay_audienceOutput;
                            gradingOutputDiv.appendChild(grade_essay_audienceElement);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                    // End of grade_narrative_text_structure grading

                    // 2.10. Make an AJAX call to the grade_essay_spelling grading function

                    fetch('/v2essay_grader/grade_essay_spelling/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify(requestData) // 'data' should include the required parameters
                    })
                        .then(response => response.json())
                        .then(responseData => {
                            // Create a new header element
                            let headerElement20 = document.createElement("h4");
                            headerElement20.textContent = "Spelling (Scored out of 6)";
                            gradingOutputDiv.appendChild(headerElement20);
                            console.log(responseData)
                            let grade_essay_audienceOutput = responseData.feedback;

                            // Display the result in the grading output div
                            let grade_essay_audienceElement = document.createElement("div");
                            grade_essay_audienceElement.innerHTML = grade_essay_audienceOutput;
                            gradingOutputDiv.appendChild(grade_essay_audienceElement);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                    // End of grade_essay_spelling grading

                }
            })
            .catch(error => {
                console.error('Error:', error);
            });

        // Hide the spinner
        document.getElementById("loadingSpinner").style.display = "none";
    }


</script>

{% endblock %}